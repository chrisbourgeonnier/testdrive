{% extends "base.html" %}
{% load static %}
{% block content %}

    <h1 class="entry-title">
        {% if object %}Reschedule booking{% else %}Book a Test Drive{% endif %}
    </h1>

    <form class="form" method="post" id="booking-form" action="">
        {% csrf_token %}
       {% if form.errors or form.non_field_errors %}
            <div class="alert alert-error" style="max-width:600px;margin:10px auto;">
                {% for field, errors in form.errors.items %}
                    {% for e in errors %}
                        <div>{{ e }}</div>
                    {% endfor %}
                {% endfor %}
                {% for e in form.non_field_errors %}
                        <div>{{ e }}</div>
                {% endfor %}
            </div>
        {% endif %}

        <div class="booking-form">
            {% with veh=object.vehicle|default:form.instance.vehicle %}
                {% if veh %}
                    <p><strong>Vehicle:</strong></p>
                    <p><strong>{{ veh.year }} {{ veh.make }} {{ veh.model }}</strong></p>
                {% endif %}
            {% endwith %}
            {{ form.vehicle }}  {# ‚Üê hidden input from the form (used in create/update) #}

            <p>
                {{ form.guest_name.label_tag }}
                {{ form.guest_name }}
            </p>
            <p>
                {{ form.guest_email.label_tag }}
                {{ form.guest_email }}
           </p>

            <p>
                {{ form.guest_phone.label_tag }}
                {{ form.guest_phone }}
            </p>

            <p>
                {{ form.dob.label_tag }}
                {{ form.dob }}
            </p>
        </div>

            <!-- Hidden booking date/time fields (populated via FullCalendar interaction) -->
            {{ form.requested_date }}
            {{ form.requested_time }}


        <div class="wide-text">
            <p><strong>Choose your preferred date and time:</strong></p>
        </div>
        <div id="calendar"></div>
        <div class="wide-text">
            <p id="selected-slot"><strong>No time selected</strong></p>
        </div>

        <div class="booking-form">
            <p>
                {{ form.captcha.label_tag }} <br>
                {{ form.captcha }}
            </p>
            <button type="submit" id="submit-button" {% if not object %}disabled{% endif %}>
                {% if object %}Save changes{% else %}Submit Booking{% endif %}
            </button>
        </div>
    </form>

    <!-- FullCalendar JS -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>

    <!-- Custom calendar JS -->
    <script src="{% static 'calendar.js' %}"></script>
{% endblock %}
